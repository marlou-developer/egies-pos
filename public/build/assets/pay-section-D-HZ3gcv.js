import{r as o,a as q,j as n,b as P,s as d}from"./app-BN_XyATP.js";import{B as z}from"./button-BACU89jm.js";import{M as G}from"./modal-uX7l4FdK.js";import{c as H,g as J}from"./cart-thunk-D1vMa9qy.js";import{g as K}from"./category-thunk-BbGFGRM6.js";import"./index-DMIjWVs5.js";import"./server.browser-00JyUhS1.js";import{S as m}from"./sweetalert2.esm.all-DV3w3JmD.js";import Q from"./print-receipt-section-BgQln3Fi.js";import"./XMarkIcon-CHUewPQX.js";import"./transition-BTuXs9rz.js";import"./dialog-BvK_MF3g.js";import"./portal--ZD5ZAR6.js";import"./index-DURAahtu.js";import"./cart-service-Be5oo0q4.js";import"./peso-BbTyboS3.js";import"./moment-C5S46NFB.js";function gt({total_price:v,totalItemDiscount:B,subtotal:N,totalDiscount:I,discount_per_order:E,data:p,shop:A,setIsModalOpen:L}){var C,w;const[V,i]=o.useState(!1),[c,r]=o.useState(!1),[W,M]=o.useState(null),[X,Z]=o.useState(!1),[R,_]=o.useState(!1),[t,f]=o.useState({customer_amount:null,change:0,payment_type:null}),[F,O]=o.useState(null),h=q(),[D,T]=o.useState(0),U=((C=t==null?void 0:t.customer)==null?void 0:C.discounts)??[],g=window.location.pathname.split("/")[3],Y=U.reduce((e,s)=>(e[s.product_id]=s,e),{}),x=p.map(e=>{const s=Y[e.id];return s?{...e,...s}:e}),y=x.map(e=>e.customer_discount?e:null).filter(e=>e!==null),u=y.reduce((e,s)=>e+Number(s.customer_discount)*Number(s.pcs),0),S=v-u;o.useEffect(()=>{t.is_credit&&f({...t,customer_amount:S,change:0})},[t.is_credit]);function l(e){i(!1),r(!1),f({customer_amount:null,change:0,payment_type:null}),M(null)}o.useEffect(()=>{c||l()},[c]);const b={cart_id:g,customer_amount:t.customer_amount,change:t.change,payment_type:t.is_credit?null:t.payment_type,cart_items:x,total_price:S,customer_total_discount:u??0,discount_per_order:E,total_item_discount:B,sub_total:N,total_discount:I+(u??0),is_credit:`${t==null?void 0:t.is_credit}`??null,due_date:(t==null?void 0:t.due_date)??null,customer_id:((w=t==null?void 0:t.customer)==null?void 0:w.id)??null,shop:A,order_id:t.order_id??null,customer_name:t.customer_name??null};async function $(e){var s,j;try{i(!0);const a=await d.dispatch(H(b));await d.dispatch(J(g)),O(((s=a==null?void 0:a.data)==null?void 0:s.cart_id)??""),await d.dispatch(K()),await m.fire({title:"Print Receipt?",text:"",icon:"success",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Print"}).then(k=>{k.isConfirmed?(k.isConfirmed&&(_(!0),i(!1)),m.fire({icon:"success",title:"Your cart has been saved",showConfirmButton:!1,timer:1500})):(h(P([])),l(),i(!1))}),L(!1),T((j=a==null?void 0:a.data)==null?void 0:j.id)}catch{await m.fire({icon:"error",title:"Payment Unsuccessful",showConfirmButton:!1,timer:1500}),i(!1)}}return console.log("list_of_available_discount",y),n.jsxs(n.Fragment,{children:[n.jsx(z,{disabled:p.length==0,onClick:()=>r(!0),className:"w-full bg-pink-500 hover:bg-pink-600",children:"Add Product Sales"}),R&&n.jsx(Q,{id:D,productId:F,reset1:()=>h(P([])),reset2:()=>l(),data:b,onPrinted:()=>_(!1)}),n.jsx(G,{onClose:()=>r(!1),isOpen:c,title:"Add Product Sales",children:n.jsxs("div",{children:[n.jsx("div",{children:"Are you sure to add this product(s) to sales?"}),n.jsxs("div",{className:"flex items-center justify-end gap-4 mt-4",children:[n.jsx("button",{onClick:()=>r(!1),className:"text-sm hover:text-gray-700 text-gray-500",children:"Cancel"}),n.jsx("button",{onClick:()=>$(),className:"text-sm bg-pink-500 text-white px-4 py-2 rounded hover:bg-pink-600 focus:outline-none focus:ring-2 focus:ring-pink-500 focus:ring-offset-2",children:"Submit"})]})]})})]})}export{gt as default};
