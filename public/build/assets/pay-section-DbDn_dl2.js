import{r as a,a as Z,j as e,b as W,s as S}from"./app-DUUAzoRr.js";import{B as b}from"./button-VU3uqYoM.js";import{I as j}from"./input-OpRI3lL8.js";import{M as q}from"./modal-Bvpjg0gQ.js";import{c as G}from"./cart-thunk-B43xtD26.js";import{g as J}from"./category-thunk-BDBs29vT.js";import{s as K}from"./customer-thunk-B7wfmBJI.js";import{r as X}from"./index-BNkzY_hn.js";import"./index-DXCwG23J.js";import"./server.browser-CXJCXd7o.js";import{S as E}from"./sweetalert2.esm.all-DV3w3JmD.js";import ee from"./print-receipt-section-BtokhJVN.js";import{F as se}from"./BanknotesIcon-a3a3hHM6.js";import"./XMarkIcon-1aMSeH-z.js";import"./transition-CxWKCe9d.js";import"./dialog-CEEcQ8Vs.js";import"./portal-CPSeVnID.js";import"./index-Q9yKfaEO.js";import"./cart-service-BLSX9yik.js";import"./peso-BbTyboS3.js";import"./moment-C5S46NFB.js";function te({title:o,titleId:r,...x},h){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:h,"aria-labelledby":r},x),o?a.createElement("title",{id:r},o):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m4.5 12.75 6 6 9-13.5"}))}const ae=a.forwardRef(te);function ne({title:o,titleId:r,...x},h){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:h,"aria-labelledby":r},x),o?a.createElement("title",{id:r},o):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 0 0 2.25-2.25V6.75A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25v10.5A2.25 2.25 0 0 0 4.5 19.5Z"}))}const ie=a.forwardRef(ne);function Ee({total_price:o,totalItemDiscount:r,subtotal:x,totalDiscount:h,discount_per_order:_,data:F,shop:u}){var O,I;const[v,p]=a.useState(!1),[k,w]=a.useState(!1),[i,P]=a.useState(null),[B,R]=a.useState(!1),[Y,D]=a.useState(!1),[s,l]=a.useState({customer_amount:null,change:0,payment_type:null}),[H,$]=a.useState(null),L=Z(),[V,z]=a.useState(0),Q=(((O=s==null?void 0:s.customer)==null?void 0:O.discounts)??[]).reduce((t,n)=>(t[n.product_id]=n,t),{}),T=F.map(t=>{const n=Q[t.id];return n?{...t,...n}:t}),d=T.map(t=>t.customer_discount?t:null).filter(t=>t!==null),m=d.reduce((t,n)=>t+Number(n.customer_discount)*Number(n.pcs),0),g=o-m;a.useEffect(()=>{s.is_credit&&l({...s,customer_amount:g,change:0})},[s.is_credit]);function y(t){p(!1),w(!1),l({customer_amount:null,change:0,payment_type:null}),P(null)}a.useEffect(()=>{k||y()},[k]);const M={customer_amount:s.customer_amount,change:s.change,payment_type:s.is_credit?null:s.payment_type,cart_items:T,total_price:g,customer_total_discount:m??0,discount_per_order:_,total_item_discount:r,sub_total:x,total_discount:h+(m??0),is_credit:`${s==null?void 0:s.is_credit}`??null,due_date:(s==null?void 0:s.due_date)??null,customer_id:((I=s==null?void 0:s.customer)==null?void 0:I.id)??null,shop:u,order_id:s.order_id??null,customer_name:s.customer_name??null};async function C(t){var n,f;try{p(!0);const c=await S.dispatch(G(M));$(((n=c==null?void 0:c.data)==null?void 0:n.cart_id)??""),await S.dispatch(J()),z((f=c==null?void 0:c.data)==null?void 0:f.id),E.fire({title:"Print Receipt?",text:"",icon:"success",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Print"}).then(A=>{A.isConfirmed?(A.isConfirmed&&(D(!0),p(!1)),E.fire({icon:"success",title:"Your cart has been saved",showConfirmButton:!1,timer:1500})):(L(W([])),y(),p(!1))})}catch{await E.fire({icon:"error",title:"Payment Unsuccessful",showConfirmButton:!1,timer:1500}),p(!1)}}async function U(t){R(!0);const n=await S.dispatch(K(t.target.value));P(n.data),R(!1)}function N(){return u=="Store"?s.is_customer&&s.change>=0&&s.payment_type?s.customer&&s.is_credit&&s.change>=0?!s.due_date:!(s.customer&&s.change>=0):s.change>=0&&s.payment_type?!1:!(s.is_credit&&s.due_date):!(s.customer_name&&s.order_id)}return console.log("list_of_available_discount",d),e.jsxs(e.Fragment,{children:[e.jsx(b,{disabled:F.length==0,onClick:()=>w(!0),className:"w-full bg-pink-500 hover:bg-pink-600",children:"PAY"}),Y&&e.jsx(ee,{id:V,productId:H,reset1:()=>L(W([])),reset2:()=>y(),data:M,onPrinted:()=>D(!1)}),e.jsx(q,{onClose:()=>w(!1),isOpen:k,title:"PAYMENT METHOD",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[d&&(d==null?void 0:d.length)!=0&&e.jsxs("div",{className:"p-4 bg-white border border-pink-500 rounded-md",children:[e.jsx("div",{className:"font-black",children:"List of Item Discount"}),e.jsx("div",{className:"flex flex-col gap-1.5",children:d==null?void 0:d.map((t,n)=>e.jsxs("div",{className:"flex items-center w-full justify-between",children:[e.jsx("div",{className:"flex-1",children:t.name}),e.jsxs("div",{className:"flex-1",children:["Product Quantity:"," ",t.pcs]}),e.jsxs("div",{className:"flex-1",children:["Discounted Price:₱"," ",Number(t.pcs)*Number(t.customer_discount).toFixed(2)]})]},n))})]}),e.jsxs("div",{className:"flex flex-row gap-10 ",children:[e.jsxs("div",{class:"flex-1 ",children:[e.jsxs("div",{class:" px-4 flex justify-between ",children:[e.jsx("span",{class:"font-semibold text-sm",children:"Subtotal"}),e.jsxs("span",{class:"font-bold",children:["₱",x.toFixed(2)]})]}),e.jsxs("div",{class:" px-4 flex justify-between ",children:[e.jsx("span",{class:"font-semibold text-sm",children:"Customer Total Discount"}),e.jsxs("span",{class:"font-bold",children:["₱",m==null?void 0:m.toFixed(2)]})]}),e.jsxs("div",{class:" px-4 flex justify-between ",children:[e.jsx("span",{class:"font-semibold text-sm",children:"Discount Per Item"}),e.jsxs("span",{class:"font-bold",children:["₱",r==null?void 0:r.toFixed(2)]})]}),e.jsxs("div",{class:" px-4 flex justify-between ",children:[e.jsx("span",{class:"font-semibold text-sm",children:"Discount Per Order"}),e.jsxs("span",{class:"font-bold",children:["₱",isNaN(parseFloat(_))?"0.00":parseFloat(_).toFixed(2)]})]}),e.jsxs("div",{class:" px-4 flex justify-between ",children:[e.jsx("span",{class:"font-semibold text-sm",children:"Total Discount"}),e.jsxs("span",{class:"font-bold",children:["₱",(h+(m??0)).toFixed(2)]})]}),e.jsxs("div",{class:"border-t-2 py-2 px-4 flex items-center justify-between",children:[e.jsx("span",{class:"font-semibold text-2xl",children:"Total"}),e.jsxs("span",{class:"font-bold text-2xl",children:["₱",g.toFixed(2)]})]}),e.jsxs("div",{class:"border-t-2 py-2 px-4 flex items-center justify-between",children:[e.jsx("span",{class:"font-semibold text-2xl",children:"Change"}),e.jsxs("span",{class:"font-bold text-2xl",children:["₱",s.change.toFixed(2)]})]})]}),e.jsx("div",{className:"border-pink-600 border-r border-2"}),u=="Shopee"&&e.jsxs("div",{className:"flex-1 flex flex-col gap-3",children:[e.jsx(j,{onChange:t=>l({...s,customer_name:t.target.value}),type:"text",value:s==null?void 0:s.customer_name,name:"customer_name",label:"Customer Name"}),e.jsx(j,{onChange:t=>l({...s,order_id:t.target.value}),type:"text",value:s==null?void 0:s.order_id,name:"order_id",label:"Shopee Order ID"})]}),u=="Store"&&e.jsxs("div",{className:"flex-1 flex flex-col gap-3",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{id:"is_customer",name:"is_customer",type:"checkbox",checked:s.is_customer,onChange:t=>l({...s,customer:null,[t.target.name]:t.target.checked}),className:"h-5 w-5 rounded border-pink-500 text-pink-600 focus:ring-pink-500 checked:bg-pink-600 checked:hover:bg-pink-600"}),e.jsx("span",{children:"Is Regular Customer?"})]}),s.is_customer&&e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{id:"is_credit",name:"is_credit",type:"checkbox",checked:s.is_credit,onChange:t=>l({...s,due_date:null,[t.target.name]:t.target.checked}),className:"h-5 w-5 rounded border-pink-500 text-pink-600 focus:ring-pink-500 checked:bg-pink-600 checked:hover:bg-pink-600"}),e.jsx("span",{children:"Is Credit?"})]}),s.is_customer&&e.jsx(j,{onChange:t=>U(t),name:"customer",label:"Search Customer"}),!B&&(i==null?void 0:i.length)==0&&e.jsx("div",{className:"text-red-600",children:"Customer not found!"}),B&&(i==null?void 0:i.length)==0&&e.jsx("div",{className:"text-gray-600",children:"Loading..."}),(s==null?void 0:s.is_customer)&&(i==null?void 0:i.length)!=0&&e.jsx("table",{className:"min-w-full divide-y divide-gray-300",children:e.jsx("tbody",{className:"divide-y divide-gray-200",children:i==null?void 0:i.map((t,n)=>{var f,c;return e.jsxs("tr",{children:[e.jsx("td",{className:"capitalize pr-3 py-2 pl-4 text-sm font-medium whitespace-nowrap text-gray-900 sm:pl-0",children:t.name}),e.jsxs("td",{className:"relative pr-4 pl-3 text-right text-sm font-medium whitespace-nowrap sm:pr-0",children:[((f=s==null?void 0:s.customer)==null?void 0:f.id)==t.id&&e.jsxs("div",{className:"flex items-end justify-end gap-6 w-full",children:[e.jsxs("button",{className:"flex gap-1",children:[e.jsx(ae,{className:"h-4 w-4 text-green-500"}),e.jsx("div",{className:" text-green-500",children:"SELECTED"})," "]}),e.jsx("button",{onClick:()=>l({...s,customer:null}),className:"text-pink-600 hover:text-pink-900",children:"REMOVE"})]}),((c=s==null?void 0:s.customer)==null?void 0:c.id)!=t.id&&e.jsx(e.Fragment,{children:e.jsx("button",{onClick:()=>l({...s,customer:t}),className:"text-pink-600 hover:text-pink-900",children:"SELECT"})})]})]},n)})})}),(s==null?void 0:s.is_credit)&&(s==null?void 0:s.is_customer)&&(i==null?void 0:i.length)!=0&&e.jsx(j,{onChange:t=>l({...s,due_date:t.target.value}),value:s.due_date,type:"date",label:"Due Date"}),e.jsx(j,{onChange:t=>l({...s,customer_amount:t.target.value,change:parseFloat(t.target.value==""?0:t.target.value)-g}),disabled:s.is_credit,value:s==null?void 0:s.customer_amount,name:"amount",label:"Cash/Amount"}),!s.is_credit&&e.jsxs("select",{onChange:t=>l({...s,payment_type:t.target.value}),className:"rounded-md text-gray-500",label:"Mode of Payment",children:[e.jsx("option",{disabled:!0,selected:!0,children:"Mode of Payment:"}),e.jsx("option",{value:"Cash",children:"Cash"}),e.jsx("option",{value:"E-Wallet",children:"E-Wallet"}),e.jsx("option",{value:"Bank Transfer",children:"Bank Transfer"}),e.jsx("option",{value:"Credit/Debit Card",children:"Credit/Debit Card"})]})]})]}),e.jsxs("div",{className:"mt-12",children:[u=="Store"&&!(s!=null&&s.is_credit)&&e.jsx(b,{disabled:N(),loading:v,onClick:C,className:"w-full bg-pink-500 hover:bg-pink-600",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(se,{className:"h-6 w-6 text-white"})," ",e.jsx("div",{children:"PAY CASH"})]})}),u=="Store"&&(s==null?void 0:s.is_credit)&&e.jsx(b,{disabled:N(),loading:v,onClick:C,className:"w-full bg-blue-500 hover:bg-blue-600",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(ie,{className:"h-5 w-5"}),e.jsx("div",{children:"CREDIT"})]})}),u=="Shopee"&&e.jsx(b,{disabled:N(),loading:v,onClick:C,className:"w-full bg-orange-700 hover:bg-orange-800",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(X,{className:"h-5 w-5"}),e.jsx("div",{children:"PROCEED SHOPEE"})]})})]})]})})]})}export{Ee as default};
