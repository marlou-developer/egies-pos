import{r as l,j as e,a as q,b as E,s as F}from"./app-BN_XyATP.js";import{B as _}from"./button-BACU89jm.js";import{I as B}from"./input-CaVbpWfX.js";import{M as J}from"./modal-uX7l4FdK.js";import{c as K}from"./cart-thunk-D1vMa9qy.js";import{g as X}from"./category-thunk-BbGFGRM6.js";import{s as Z}from"./customer-thunk-B0AbNA74.js";import{r as ee}from"./index-BQjH03Km.js";import"./index-DMIjWVs5.js";import"./server.browser-00JyUhS1.js";import{S as y}from"./sweetalert2.esm.all-DV3w3JmD.js";import se from"./print-receipt-section-DMs_ZbQv.js";import{F as te}from"./BanknotesIcon-BYLFkxxQ.js";import{F as ae}from"./CreditCardIcon-DJ5laL5U.js";import"./XMarkIcon-CHUewPQX.js";import"./transition-BTuXs9rz.js";import"./dialog-BvK_MF3g.js";import"./portal--ZD5ZAR6.js";import"./index-DURAahtu.js";import"./cart-service-Be5oo0q4.js";import"./peso-BbTyboS3.js";import"./moment-C5S46NFB.js";function ne({title:u,titleId:c,...x},p){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:p,"aria-labelledby":c},x),u?l.createElement("title",{id:c},u):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m4.5 12.75 6 6 9-13.5"}))}const le=l.forwardRef(ne),ie=({label:u,options:c,value:x,onChange:p})=>e.jsxs("div",{className:"flex flex-col gap-1",children:[u&&e.jsx("label",{className:"text-sm font-medium text-gray-700",children:u}),e.jsx("select",{value:x,onChange:p,className:"px-3 py-2 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm",children:c.map((m,g)=>e.jsx("option",{value:m.value,children:m.label},g))})]});function Fe({total_price:u,totalItemDiscount:c,subtotal:x,totalDiscount:p,discount_per_order:m,data:g,shop:d}){var Y,A;const[w,f]=l.useState(!1),[N,k]=l.useState(!1),[n,D]=l.useState(null),[R,T]=l.useState(!1),[W,I]=l.useState(!1),[s,i]=l.useState({customer_amount:null,change:0,payment_type:null}),[$,G]=l.useState(null),C=q(),[z,Q]=l.useState(0),U=(((Y=s==null?void 0:s.customer)==null?void 0:Y.discounts)??[]).reduce((t,a)=>(t[a.product_id]=a,t),{}),L=g.map(t=>{const a=U[t.id];return a?{...t,...a}:t}),o=L.map(t=>t.customer_discount?t:null).filter(t=>t!==null),h=o.reduce((t,a)=>t+Number(a.customer_discount)*Number(a.pcs),0),b=u-h;l.useEffect(()=>{s.is_credit&&i({...s,customer_amount:b,change:0})},[s.is_credit]);function v(t){f(!1),k(!1),i({customer_amount:null,change:0,payment_type:null}),D(null)}l.useEffect(()=>{N||v()},[N]);const M={customer_amount:s.customer_amount,change:s.change,payment_type:s.is_credit?null:s.payment_type,cart_items:L,total_price:b,customer_total_discount:h??0,discount_per_order:m,total_item_discount:c,sub_total:x,total_discount:p+(h??0),is_credit:`${s==null?void 0:s.is_credit}`??null,due_date:(s==null?void 0:s.due_date)??null,customer_id:((A=s==null?void 0:s.customer)==null?void 0:A.id)??null,shop:d,order_id:s.order_id??null,customer_name:s.customer_name??null,shopee_store:s.shopee_store??null};async function S(t){var a,j;try{f(!0);const r=await F.dispatch(K(M));G(((a=r==null?void 0:r.data)==null?void 0:a.cart_id)??""),await F.dispatch(X()),Q((j=r==null?void 0:r.data)==null?void 0:j.id),d=="Store"?y.fire({title:"Print Receipt?",text:"",icon:"success",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Print"}).then(H=>{H.isConfirmed?(H.isConfirmed&&(I(!0),f(!1)),y.fire({icon:"success",title:"Your cart has been saved",showConfirmButton:!1,timer:1500})):(C(E([])),v(),f(!1))}):(await y.fire({icon:"success",title:"Your cart has been saved",showConfirmButton:!1,timer:1500}),C(E([])),v(),f(!1))}catch{await y.fire({icon:"error",title:"Payment Unsuccessful",showConfirmButton:!1,timer:1500}),f(!1)}}async function V(t){T(!0);const a=await F.dispatch(Z(t.target.value));D(a.data),T(!1)}function P(){return d=="Store"?s.is_customer&&s.change>=0&&s.payment_type?s.customer&&s.is_credit&&s.change>=0?!s.due_date:!(s.customer&&s.change>=0):s.change>=0&&s.payment_type?!1:!(s.is_credit&&s.due_date):!s.shopee_store}const O=x<m;return console.log("overall_total",O),e.jsxs(e.Fragment,{children:[e.jsx(_,{disabled:g.length==0||O,onClick:()=>k(!0),className:"w-full bg-pink-500 hover:bg-pink-600",children:"PAY"}),W&&e.jsx(se,{id:z,productId:$,reset1:()=>C(E([])),reset2:()=>v(),data:M,onPrinted:()=>I(!1)}),e.jsx(J,{onClose:()=>k(!1),isOpen:N,title:"PAYMENT METHOD",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[o&&(o==null?void 0:o.length)!=0&&e.jsxs("div",{className:"p-4 bg-white border border-pink-500 rounded-md",children:[e.jsx("div",{className:"font-black",children:"List of Item Discount"}),e.jsx("div",{className:"flex flex-col gap-1.5",children:o==null?void 0:o.map((t,a)=>e.jsxs("div",{className:"flex items-center w-full justify-between",children:[e.jsx("div",{className:"flex-1",children:t.name}),e.jsxs("div",{className:"flex-1",children:["Product Quantity:"," ",t.pcs]}),e.jsxs("div",{className:"flex-1",children:["Discounted Price:₱"," ",Number(t.pcs)*Number(t.customer_discount).toFixed(2)]})]},a))})]}),e.jsxs("div",{className:"flex flex-row gap-10 ",children:[e.jsxs("div",{class:"flex-1 ",children:[e.jsxs("div",{class:" px-4 flex justify-between ",children:[e.jsx("span",{class:"font-semibold text-sm",children:"Subtotal"}),e.jsxs("span",{class:"font-bold",children:["₱",x.toFixed(2)]})]}),e.jsxs("div",{class:" px-4 flex justify-between ",children:[e.jsx("span",{class:"font-semibold text-sm",children:"Customer Total Discount"}),e.jsxs("span",{class:"font-bold",children:["₱",h==null?void 0:h.toFixed(2)]})]}),e.jsxs("div",{class:" px-4 flex justify-between ",children:[e.jsx("span",{class:"font-semibold text-sm",children:"Discount Per Item"}),e.jsxs("span",{class:"font-bold",children:["₱",c==null?void 0:c.toFixed(2)]})]}),e.jsxs("div",{class:" px-4 flex justify-between ",children:[e.jsx("span",{class:"font-semibold text-sm",children:"Discount Per Order"}),e.jsxs("span",{class:"font-bold",children:["₱",isNaN(parseFloat(m))?"0.00":parseFloat(m).toFixed(2)]})]}),e.jsxs("div",{class:" px-4 flex justify-between ",children:[e.jsx("span",{class:"font-semibold text-sm",children:"Total Discount"}),e.jsxs("span",{class:"font-bold",children:["₱",(p+(h??0)).toFixed(2)]})]}),e.jsxs("div",{class:"border-t-2 py-2 px-4 flex items-center justify-between",children:[e.jsx("span",{class:"font-semibold text-2xl",children:"Total"}),e.jsxs("span",{class:"font-bold text-2xl",children:["₱",b.toFixed(2)]})]}),e.jsxs("div",{class:"border-t-2 py-2 px-4 flex items-center justify-between",children:[e.jsx("span",{class:"font-semibold text-2xl",children:"Change"}),e.jsxs("span",{class:"font-bold text-2xl",children:["₱",s.change.toFixed(2)]})]})]}),e.jsx("div",{className:"border-pink-600 border-r border-2"}),d=="Shopee"&&e.jsx("div",{className:"flex-1 flex flex-col gap-3",children:e.jsx(ie,{label:"Shopee Store",onChange:t=>i({...s,shopee_store:t.target.value}),options:[{label:"",value:""},{label:"You Glow Darling PH",value:"You Glow Darling PH"},{label:"Beauty In Pink",value:"Beauty In Pink"}]})}),d=="Store"&&e.jsxs("div",{className:"flex-1 flex flex-col gap-3",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{id:"is_customer",name:"is_customer",type:"checkbox",checked:s.is_customer,onChange:t=>i({...s,customer:null,[t.target.name]:t.target.checked}),className:"h-5 w-5 rounded border-pink-500 text-pink-600 focus:ring-pink-500 checked:bg-pink-600 checked:hover:bg-pink-600"}),e.jsx("span",{children:"Is Regular Customer?"})]}),s.is_customer&&e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{id:"is_credit",name:"is_credit",type:"checkbox",checked:s.is_credit,onChange:t=>i({...s,due_date:null,[t.target.name]:t.target.checked}),className:"h-5 w-5 rounded border-pink-500 text-pink-600 focus:ring-pink-500 checked:bg-pink-600 checked:hover:bg-pink-600"}),e.jsx("span",{children:"Is Credit?"})]}),s.is_customer&&e.jsx(B,{onChange:t=>V(t),name:"customer",label:"Search Customer"}),!R&&(n==null?void 0:n.length)==0&&e.jsx("div",{className:"text-red-600",children:"Customer not found!"}),R&&(n==null?void 0:n.length)==0&&e.jsx("div",{className:"text-gray-600",children:"Loading..."}),(s==null?void 0:s.is_customer)&&(n==null?void 0:n.length)!=0&&e.jsx("table",{className:"min-w-full divide-y divide-gray-300",children:e.jsx("tbody",{className:"divide-y divide-gray-200",children:n==null?void 0:n.map((t,a)=>{var j,r;return e.jsxs("tr",{children:[e.jsx("td",{className:"capitalize pr-3 py-2 pl-4 text-sm font-medium whitespace-nowrap text-gray-900 sm:pl-0",children:t.name}),e.jsxs("td",{className:"relative pr-4 pl-3 text-right text-sm font-medium whitespace-nowrap sm:pr-0",children:[((j=s==null?void 0:s.customer)==null?void 0:j.id)==t.id&&e.jsxs("div",{className:"flex items-end justify-end gap-6 w-full",children:[e.jsxs("button",{className:"flex gap-1",children:[e.jsx(le,{className:"h-4 w-4 text-green-500"}),e.jsx("div",{className:" text-green-500",children:"SELECTED"})," "]}),e.jsx("button",{onClick:()=>i({...s,customer:null}),className:"text-pink-600 hover:text-pink-900",children:"REMOVE"})]}),((r=s==null?void 0:s.customer)==null?void 0:r.id)!=t.id&&e.jsx(e.Fragment,{children:e.jsx("button",{onClick:()=>i({...s,customer:t}),className:"text-pink-600 hover:text-pink-900",children:"SELECT"})})]})]},a)})})}),(s==null?void 0:s.is_credit)&&(s==null?void 0:s.is_customer)&&(n==null?void 0:n.length)!=0&&e.jsx(B,{onChange:t=>i({...s,due_date:t.target.value}),value:s.due_date,type:"date",label:"Due Date"}),e.jsx(B,{onChange:t=>i({...s,customer_amount:t.target.value,change:parseFloat(t.target.value==""?0:t.target.value)-b}),disabled:s.is_credit,value:s==null?void 0:s.customer_amount,name:"amount",label:"Cash/Amount"}),!s.is_credit&&e.jsxs("select",{onChange:t=>i({...s,payment_type:t.target.value}),className:"rounded-md text-gray-500",label:"Mode of Payment",children:[e.jsx("option",{disabled:!0,selected:!0,children:"Mode of Payment:"}),e.jsx("option",{value:"Cash",children:"Cash"}),e.jsx("option",{value:"E-Wallet",children:"E-Wallet"}),e.jsx("option",{value:"Bank Transfer",children:"Bank Transfer"}),e.jsx("option",{value:"Credit/Debit Card",children:"Credit/Debit Card"})]})]})]}),e.jsxs("div",{className:"mt-12",children:[d=="Store"&&!(s!=null&&s.is_credit)&&e.jsx(_,{disabled:P(),loading:w,onClick:S,className:"w-full bg-pink-500 hover:bg-pink-600",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(te,{className:"h-6 w-6 text-white"})," ",e.jsx("div",{children:"PAY CASH"})]})}),d=="Store"&&(s==null?void 0:s.is_credit)&&e.jsx(_,{disabled:P(),loading:w,onClick:S,className:"w-full bg-blue-500 hover:bg-blue-600",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(ae,{className:"h-5 w-5"}),e.jsx("div",{children:"CREDIT"})]})}),d=="Shopee"&&e.jsx(_,{disabled:P(),loading:w,onClick:S,className:"w-full bg-orange-700 hover:bg-orange-800",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(ee,{className:"h-5 w-5"}),e.jsx("div",{children:"PROCEED SHOPEE"})]})})]})]})})]})}export{Fe as default};
