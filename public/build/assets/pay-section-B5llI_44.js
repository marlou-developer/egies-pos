import{r as a,j as e,a as Z,b as F,s as B}from"./app-IoRYxtHb.js";import{B as w}from"./button-D51UmwcM.js";import{I as j}from"./input-GU9ZTq38.js";import{M as q}from"./modal-B1HM7T01.js";import{c as J}from"./cart-thunk-B9wVTu7q.js";import{g as K}from"./category-thunk-BJTSm0t3.js";import{s as X}from"./customer-thunk-Bsr0XZyM.js";import{r as ee}from"./index-gfnJ1zQv.js";import"./index-C66Zt1Yq.js";import"./server.browser-S6WutHgh.js";import{S as y}from"./sweetalert2.esm.all-DV3w3JmD.js";import se from"./print-receipt-section-DnUGk0iS.js";import{F as te}from"./BanknotesIcon-B0Bt6n0U.js";import"./XMarkIcon-AX-rgQoU.js";import"./transition-COXvBFud.js";import"./dialog-DEF4zxA2.js";import"./portal-BifcgMBW.js";import"./index-DxPxctx7.js";import"./cart-service-S1rr0O20.js";import"./peso-BbTyboS3.js";import"./moment-C5S46NFB.js";function ae({title:c,titleId:i,...o},u){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:u,"aria-labelledby":i},o),c?a.createElement("title",{id:i},c):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m4.5 12.75 6 6 9-13.5"}))}const ne=a.forwardRef(ae);function le({title:c,titleId:i,...o},u){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:u,"aria-labelledby":i},o),c?a.createElement("title",{id:i},c):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 0 0 2.25-2.25V6.75A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25v10.5A2.25 2.25 0 0 0 4.5 19.5Z"}))}const ie=a.forwardRef(le),re=({label:c,options:i,value:o,onChange:u})=>e.jsxs("div",{className:"flex flex-col gap-1",children:[c&&e.jsx("label",{className:"text-sm font-medium text-gray-700",children:c}),e.jsx("select",{value:o,onChange:u,className:"px-3 py-2 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm",children:i.map((h,b)=>e.jsx("option",{value:h.value,children:h.label},b))})]});function Fe({total_price:c,totalItemDiscount:i,subtotal:o,totalDiscount:u,discount_per_order:h,data:b,shop:m}){var A,Y;const[k,f]=a.useState(!1),[C,N]=a.useState(!1),[l,D]=a.useState(null),[R,L]=a.useState(!1),[W,T]=a.useState(!1),[s,r]=a.useState({customer_amount:null,change:0,payment_type:null}),[$,G]=a.useState(null),S=Z(),[V,z]=a.useState(0),Q=(((A=s==null?void 0:s.customer)==null?void 0:A.discounts)??[]).reduce((t,n)=>(t[n.product_id]=n,t),{}),I=b.map(t=>{const n=Q[t.id];return n?{...t,...n}:t}),x=I.map(t=>t.customer_discount?t:null).filter(t=>t!==null),p=x.reduce((t,n)=>t+Number(n.customer_discount)*Number(n.pcs),0),v=c-p;a.useEffect(()=>{s.is_credit&&r({...s,customer_amount:v,change:0})},[s.is_credit]);function _(t){f(!1),N(!1),r({customer_amount:null,change:0,payment_type:null}),D(null)}a.useEffect(()=>{C||_()},[C]);const M={customer_amount:s.customer_amount,change:s.change,payment_type:s.is_credit?null:s.payment_type,cart_items:I,total_price:v,customer_total_discount:p??0,discount_per_order:h,total_item_discount:i,sub_total:o,total_discount:u+(p??0),is_credit:`${s==null?void 0:s.is_credit}`??null,due_date:(s==null?void 0:s.due_date)??null,customer_id:((Y=s==null?void 0:s.customer)==null?void 0:Y.id)??null,shop:m,order_id:s.order_id??null,customer_name:s.customer_name??null,shopee_store:s.shopee_store??null};async function E(t){var n,g;try{f(!0);const d=await B.dispatch(J(M));G(((n=d==null?void 0:d.data)==null?void 0:n.cart_id)??""),await B.dispatch(K()),z((g=d==null?void 0:d.data)==null?void 0:g.id),m=="Store"?y.fire({title:"Print Receipt?",text:"",icon:"success",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Print"}).then(H=>{H.isConfirmed?(H.isConfirmed&&(T(!0),f(!1)),y.fire({icon:"success",title:"Your cart has been saved",showConfirmButton:!1,timer:1500})):(S(F([])),_(),f(!1))}):(await y.fire({icon:"success",title:"Your cart has been saved",showConfirmButton:!1,timer:1500}),S(F([])),_(),f(!1))}catch{await y.fire({icon:"error",title:"Payment Unsuccessful",showConfirmButton:!1,timer:1500}),f(!1)}}async function U(t){L(!0);const n=await B.dispatch(X(t.target.value));D(n.data),L(!1)}function P(){return m=="Store"?s.is_customer&&s.change>=0&&s.payment_type?s.customer&&s.is_credit&&s.change>=0?!s.due_date:!(s.customer&&s.change>=0):s.change>=0&&s.payment_type?!1:!(s.is_credit&&s.due_date):!(s.customer_name&&s.order_id)}const O=o<h;return console.log("overall_total",O),e.jsxs(e.Fragment,{children:[e.jsx(w,{disabled:b.length==0||O,onClick:()=>N(!0),className:"w-full bg-pink-500 hover:bg-pink-600",children:"PAY"}),W&&e.jsx(se,{id:V,productId:$,reset1:()=>S(F([])),reset2:()=>_(),data:M,onPrinted:()=>T(!1)}),e.jsx(q,{onClose:()=>N(!1),isOpen:C,title:"PAYMENT METHOD",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[x&&(x==null?void 0:x.length)!=0&&e.jsxs("div",{className:"p-4 bg-white border border-pink-500 rounded-md",children:[e.jsx("div",{className:"font-black",children:"List of Item Discount"}),e.jsx("div",{className:"flex flex-col gap-1.5",children:x==null?void 0:x.map((t,n)=>e.jsxs("div",{className:"flex items-center w-full justify-between",children:[e.jsx("div",{className:"flex-1",children:t.name}),e.jsxs("div",{className:"flex-1",children:["Product Quantity:"," ",t.pcs]}),e.jsxs("div",{className:"flex-1",children:["Discounted Price:₱"," ",Number(t.pcs)*Number(t.customer_discount).toFixed(2)]})]},n))})]}),e.jsxs("div",{className:"flex flex-row gap-10 ",children:[e.jsxs("div",{class:"flex-1 ",children:[e.jsxs("div",{class:" px-4 flex justify-between ",children:[e.jsx("span",{class:"font-semibold text-sm",children:"Subtotal"}),e.jsxs("span",{class:"font-bold",children:["₱",o.toFixed(2)]})]}),e.jsxs("div",{class:" px-4 flex justify-between ",children:[e.jsx("span",{class:"font-semibold text-sm",children:"Customer Total Discount"}),e.jsxs("span",{class:"font-bold",children:["₱",p==null?void 0:p.toFixed(2)]})]}),e.jsxs("div",{class:" px-4 flex justify-between ",children:[e.jsx("span",{class:"font-semibold text-sm",children:"Discount Per Item"}),e.jsxs("span",{class:"font-bold",children:["₱",i==null?void 0:i.toFixed(2)]})]}),e.jsxs("div",{class:" px-4 flex justify-between ",children:[e.jsx("span",{class:"font-semibold text-sm",children:"Discount Per Order"}),e.jsxs("span",{class:"font-bold",children:["₱",isNaN(parseFloat(h))?"0.00":parseFloat(h).toFixed(2)]})]}),e.jsxs("div",{class:" px-4 flex justify-between ",children:[e.jsx("span",{class:"font-semibold text-sm",children:"Total Discount"}),e.jsxs("span",{class:"font-bold",children:["₱",(u+(p??0)).toFixed(2)]})]}),e.jsxs("div",{class:"border-t-2 py-2 px-4 flex items-center justify-between",children:[e.jsx("span",{class:"font-semibold text-2xl",children:"Total"}),e.jsxs("span",{class:"font-bold text-2xl",children:["₱",v.toFixed(2)]})]}),e.jsxs("div",{class:"border-t-2 py-2 px-4 flex items-center justify-between",children:[e.jsx("span",{class:"font-semibold text-2xl",children:"Change"}),e.jsxs("span",{class:"font-bold text-2xl",children:["₱",s.change.toFixed(2)]})]})]}),e.jsx("div",{className:"border-pink-600 border-r border-2"}),m=="Shopee"&&e.jsxs("div",{className:"flex-1 flex flex-col gap-3",children:[e.jsx(re,{label:"Shopee Store",onChange:t=>r({...s,shopee_store:t.target.value}),options:[{label:"",value:""},{label:"You Glow Darling PH",value:"You Glow Darling PH"},{label:"Beauty In Pink",value:"Beauty In Pink"}]}),e.jsx(j,{onChange:t=>r({...s,customer_name:t.target.value}),type:"text",value:s==null?void 0:s.customer_name,name:"customer_name",label:"Customer Name"}),e.jsx(j,{onChange:t=>r({...s,order_id:t.target.value}),type:"text",value:s==null?void 0:s.order_id,name:"order_id",label:"Shopee Order ID"})]}),m=="Store"&&e.jsxs("div",{className:"flex-1 flex flex-col gap-3",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{id:"is_customer",name:"is_customer",type:"checkbox",checked:s.is_customer,onChange:t=>r({...s,customer:null,[t.target.name]:t.target.checked}),className:"h-5 w-5 rounded border-pink-500 text-pink-600 focus:ring-pink-500 checked:bg-pink-600 checked:hover:bg-pink-600"}),e.jsx("span",{children:"Is Regular Customer?"})]}),s.is_customer&&e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{id:"is_credit",name:"is_credit",type:"checkbox",checked:s.is_credit,onChange:t=>r({...s,due_date:null,[t.target.name]:t.target.checked}),className:"h-5 w-5 rounded border-pink-500 text-pink-600 focus:ring-pink-500 checked:bg-pink-600 checked:hover:bg-pink-600"}),e.jsx("span",{children:"Is Credit?"})]}),s.is_customer&&e.jsx(j,{onChange:t=>U(t),name:"customer",label:"Search Customer"}),!R&&(l==null?void 0:l.length)==0&&e.jsx("div",{className:"text-red-600",children:"Customer not found!"}),R&&(l==null?void 0:l.length)==0&&e.jsx("div",{className:"text-gray-600",children:"Loading..."}),(s==null?void 0:s.is_customer)&&(l==null?void 0:l.length)!=0&&e.jsx("table",{className:"min-w-full divide-y divide-gray-300",children:e.jsx("tbody",{className:"divide-y divide-gray-200",children:l==null?void 0:l.map((t,n)=>{var g,d;return e.jsxs("tr",{children:[e.jsx("td",{className:"capitalize pr-3 py-2 pl-4 text-sm font-medium whitespace-nowrap text-gray-900 sm:pl-0",children:t.name}),e.jsxs("td",{className:"relative pr-4 pl-3 text-right text-sm font-medium whitespace-nowrap sm:pr-0",children:[((g=s==null?void 0:s.customer)==null?void 0:g.id)==t.id&&e.jsxs("div",{className:"flex items-end justify-end gap-6 w-full",children:[e.jsxs("button",{className:"flex gap-1",children:[e.jsx(ne,{className:"h-4 w-4 text-green-500"}),e.jsx("div",{className:" text-green-500",children:"SELECTED"})," "]}),e.jsx("button",{onClick:()=>r({...s,customer:null}),className:"text-pink-600 hover:text-pink-900",children:"REMOVE"})]}),((d=s==null?void 0:s.customer)==null?void 0:d.id)!=t.id&&e.jsx(e.Fragment,{children:e.jsx("button",{onClick:()=>r({...s,customer:t}),className:"text-pink-600 hover:text-pink-900",children:"SELECT"})})]})]},n)})})}),(s==null?void 0:s.is_credit)&&(s==null?void 0:s.is_customer)&&(l==null?void 0:l.length)!=0&&e.jsx(j,{onChange:t=>r({...s,due_date:t.target.value}),value:s.due_date,type:"date",label:"Due Date"}),e.jsx(j,{onChange:t=>r({...s,customer_amount:t.target.value,change:parseFloat(t.target.value==""?0:t.target.value)-v}),disabled:s.is_credit,value:s==null?void 0:s.customer_amount,name:"amount",label:"Cash/Amount"}),!s.is_credit&&e.jsxs("select",{onChange:t=>r({...s,payment_type:t.target.value}),className:"rounded-md text-gray-500",label:"Mode of Payment",children:[e.jsx("option",{disabled:!0,selected:!0,children:"Mode of Payment:"}),e.jsx("option",{value:"Cash",children:"Cash"}),e.jsx("option",{value:"E-Wallet",children:"E-Wallet"}),e.jsx("option",{value:"Bank Transfer",children:"Bank Transfer"}),e.jsx("option",{value:"Credit/Debit Card",children:"Credit/Debit Card"})]})]})]}),e.jsxs("div",{className:"mt-12",children:[m=="Store"&&!(s!=null&&s.is_credit)&&e.jsx(w,{disabled:P(),loading:k,onClick:E,className:"w-full bg-pink-500 hover:bg-pink-600",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(te,{className:"h-6 w-6 text-white"})," ",e.jsx("div",{children:"PAY CASH"})]})}),m=="Store"&&(s==null?void 0:s.is_credit)&&e.jsx(w,{disabled:P(),loading:k,onClick:E,className:"w-full bg-blue-500 hover:bg-blue-600",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(ie,{className:"h-5 w-5"}),e.jsx("div",{children:"CREDIT"})]})}),m=="Shopee"&&e.jsx(w,{disabled:P(),loading:k,onClick:E,className:"w-full bg-orange-700 hover:bg-orange-800",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(ee,{className:"h-5 w-5"}),e.jsx("div",{children:"PROCEED SHOPEE"})]})})]})]})})]})}export{Fe as default};
