import{r as o,a as G,j as n,b as P,s as d}from"./app-BwT4KVlY.js";import{B as H}from"./button-qmVFk7mA.js";import{M as J}from"./modal-D7hMVrc-.js";import{c as K,g as Q}from"./cart-thunk-Cv_jsGrG.js";import{g as V}from"./category-thunk-D3YRmrkK.js";import"./index-BvpcGl4-.js";import"./server.browser-Cqioig_h.js";import{S as m}from"./sweetalert2.esm.all-DV3w3JmD.js";import W from"./print-receipt-section-hIbfF2H2.js";import"./XMarkIcon-cWOD0dI8.js";import"./transition-BgpyGLx8.js";import"./dialog-DlEWJLNz.js";import"./portal-BgmFxNbQ.js";import"./index-Bk68MUvn.js";import"./cart-service-D_3mAGru.js";import"./peso-BbTyboS3.js";import"./moment-C5S46NFB.js";function gt({total_price:B,totalItemDiscount:N,subtotal:I,totalDiscount:E,discount_per_order:A,data:p,shop:L,setIsModalOpen:M}){var w,j;const[_,i]=o.useState(!1),[c,r]=o.useState(!1),[X,R]=o.useState(null),[Z,$]=o.useState(!1),[F,f]=o.useState(!1),[t,h]=o.useState({customer_amount:null,change:0,payment_type:null}),[O,D]=o.useState(null),g=G(),[T,U]=o.useState(0),Y=((w=t==null?void 0:t.customer)==null?void 0:w.discounts)??[],x=window.location.pathname.split("/")[4],q=Y.reduce((e,s)=>(e[s.product_id]=s,e),{}),y=p.map(e=>{const s=q[e.id];return s?{...e,...s}:e}),S=y.map(e=>e.customer_discount?e:null).filter(e=>e!==null),u=S.reduce((e,s)=>e+Number(s.customer_discount)*Number(s.pcs),0),b=B-u;o.useEffect(()=>{t.is_credit&&h({...t,customer_amount:b,change:0})},[t.is_credit]);function l(e){i(!1),r(!1),h({customer_amount:null,change:0,payment_type:null}),R(null)}o.useEffect(()=>{c||l()},[c]);const C={cart_id:x,customer_amount:t.customer_amount,change:t.change,payment_type:t.is_credit?null:t.payment_type,cart_items:y,total_price:b,customer_total_discount:u??0,discount_per_order:A,total_item_discount:N,sub_total:I,total_discount:E+(u??0),is_credit:"true",due_date:(t==null?void 0:t.due_date)??null,customer_id:((j=t==null?void 0:t.customer)==null?void 0:j.id)??null,shop:L,order_id:t.order_id??null,customer_name:t.customer_name??null};async function z(e){var s,k;try{i(!0);const a=await d.dispatch(K(C));await d.dispatch(Q(x)),D(((s=a==null?void 0:a.data)==null?void 0:s.cart_id)??""),await d.dispatch(V()),await m.fire({title:"Print Receipt?",text:"",icon:"success",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Print"}).then(v=>{v.isConfirmed?(v.isConfirmed&&(f(!0),i(!1)),m.fire({icon:"success",title:"Your cart has been saved",showConfirmButton:!1,timer:1500})):(g(P([])),l(),i(!1))}),M(!1),U((k=a==null?void 0:a.data)==null?void 0:k.id)}catch{await m.fire({icon:"error",title:"Payment Unsuccessful",showConfirmButton:!1,timer:1500}),i(!1)}}return console.log("list_of_available_discount",S),n.jsxs(n.Fragment,{children:[n.jsx(H,{disabled:p.length==0,onClick:()=>r(!0),className:"w-full bg-pink-500 hover:bg-pink-600",children:"Add Product Sales"}),F&&n.jsx(W,{id:T,productId:O,reset1:()=>g(P([])),reset2:()=>l(),data:C,onPrinted:()=>f(!1)}),n.jsx(J,{onClose:()=>r(!1),isOpen:c,title:"Add Product Sales",children:n.jsxs("div",{children:[n.jsx("div",{children:"Are you sure to add this product(s) to sales?"}),n.jsxs("div",{className:"flex items-center justify-end gap-4 mt-4",children:[n.jsx("button",{onClick:()=>r(!1),className:"text-sm hover:text-gray-700 text-gray-500",children:"Cancel"}),n.jsx("button",{onClick:()=>z(),disabled:_,className:"text-sm bg-pink-500 text-white px-4 py-2 rounded hover:bg-pink-600 focus:outline-none focus:ring-2 focus:ring-pink-500 focus:ring-offset-2",children:_?"Saving...":"Submit"})]})]})})]})}export{gt as default};
